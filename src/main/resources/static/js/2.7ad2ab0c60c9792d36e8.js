webpackJsonp([2],{"8/c5":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("VCXJ"),n=a("deUW"),s=a.n(n),i=(a("iXji"),a("HYcC"),a("ZpoT"),a("UpQd"),a("8r0S")),o=a("4qlE"),l=a("rDwd"),c=a("IcnI"),u=(a("cHtD"),{data:function(){return{markInfoObj:s.a.Object.extend("markInfo"),likesObj:s.a.Object.extend("likes"),markInfo:{message:""},tableData:[]}},mounted:function(){},methods:{handleClick:function(e){this.$layer.closeAll(),this.$store.state.routerObj.push({name:"contentPage",params:{id:e.uid}})},pullMarkInfo:function(){var e=this;if(null!=s.a.User.current()){var t=s.a.User.current().attributes.username,a=new this.markInfoObj;a.set("userName",t),a.set("message",this.markInfo.message),a.set("markId",this.$store.state.markId),a.set("count",0),a.save().then(function(t){e.$store.dispatch("updateLikesCount",e.$store.state.markId),e.$layer.alert("评论成功!"),e.markInfo.message=""},function(t){e.$layer.alert("出了点问题，请稍后再试!"),console.error(t)})}else this.$layer.alert("请登录后评论!")}},computed:{getData:function(){return this.$store.state.markId},markInfoStat:function(){return this.$store.state.infoData}},watch:{getData:function(e){}}}),m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{staticClass:"m-el-container"},[a("el-header",{staticClass:"m-el-header"},[a("el-table",{staticStyle:{width:"100%",height:"100%"},attrs:{data:e.markInfoStat,height:"100%"}},[a("el-table-column",{attrs:{prop:"name",label:"作者"}}),e._v(" "),a("el-table-column",{attrs:{prop:"info",label:"标题",showOverflowTooltip:""}}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"m-el-button",attrs:{type:"text"},on:{click:function(a){e.handleClick(t.row)}}},[e._v("查看详情")])]}}])})],1)],1)],1)},staticRenderFns:[]},h=a("Mw9A")(u,m,!1,function(e){a("wMrN")},null,null).exports,d={components:{markInfo:h},name:"index",data:function(){return{mapData:{zoom:2,center:[-116.25,127.625],minZoom:2,maxZoom:7,bounds:new L.LatLngBounds(new L.LatLng(-49.875,34.25),new L.LatLng(-206,221)),crs:L.CRS.Simple,url:"http://map-1251768480.file.myqcloud.com/map/{z}_{x}_{y}.png"},map:{},markerCatalog:i.a,typeListIndex:"",markerStyle:{},visibleMarker:{},cacheMarker:[],markerGroup:[],search:"",display:"none",loginSign:"ZAD",currentUser:null,markObj:s.a.Object.extend("markObj"),infoHtml:'',textUpdate:"",typeSelect:[],selectModle:!1}},methods:{test:function(e){(new(s.a.Object.extend("TestObject"))).save({words:"Hello World!"}),alert("LeanCloud Rocks!")},openInfoL:function(){this.$message({dangerouslyUseHTMLString:!0,center:!0,showClose:!0,duration:0,message:this.infoHtml})},getMapObject:function(){},updateInfo:function(){this.$message({dangerouslyUseHTMLString:!0,showClose:!0,duration:4e3,message:this.textUpdate,type:"success"})},getCenter:function(){},initMap:function(){this.map=L.map("MapContainer",{crs:this.mapData.crs,attributionControl:!0,maxBounds:this.mapData.bounds,maxBoundsViscosity:1}).setView([0,0],2);L.tileLayer(this.mapData.url,{attribution:"",minZoom:2,maxZoom:7,noWrap:!0,bounds:this.mapData.bounds}).addTo(this.map)},handleMarkData:function(){for(var e=this.markerCatalog,t=0;t<e.length;t++)for(var a=0;a<e[t].children.length;a++)this.markerStyle[e[t].children[a].id]=e[t].children[a].img,this.visibleMarker[e[t].children[a].id]=!1},toggleVisible:function(e,t){this.typeListIndex=e;var a=this.selectModle;if(null!=t&&t.ctrlKey||a)this.visibleMarker[e]?(this.visibleMarker[e]=!1,this.typeSelect[e]=!1):(this.visibleMarker[e]=!0,this.typeSelect[e]=!0);else{for(var n in this.visibleMarker)this.visibleMarker.hasOwnProperty(n)&&(this.visibleMarker[n]=!1,this.typeSelect[n]=!1);this.visibleMarker[e]=!0,this.typeSelect[e]=!0}r.default.set(this.visibleMarker,e,this.visibleMarker[e]),r.default.set(this.typeSelect,e,this.typeSelect[e]),this.refreshMarker("filter")},refreshMarker:function(e){var t=this,a=this.$router;this.$store.commit("setRouterObj",a),this.cacheMarker.length>0&&this.markerGroup.clearLayers(),this.cacheMarker.splice(0,this.cacheMarker.length),this.cacheMarker=[],this.map.rem;for(var n=0;n<o.a.length;n++){var i=!1;if("filter"===e&&this.visibleMarker[o.a[n].markerCategoryId]&&(i=!0),"search"===e){var u=this.search;-1!==o.a[n].name.toLowerCase().replace(/^\s+|\s+$/g,"").indexOf(u.toLowerCase().replace(/^\s+|\s+$/,""))&&(i=!0),-1!==o.a[n].description.toLowerCase().replace(/^\s+|\s+$/g,"").indexOf(u.toLowerCase().replace(/^\s+|\s+$/,""))&&(i=!0)}i&&function(){var e=void 0,i=void 0;null!=o.a[n].enName?(e=o.a[n].markerCategoryId+"-"+o.a[n].id+"-"+o.a[n].enName.replace(/[^A-Z]/gi,"-"),i=o.a[n].markerCategoryId+"-"+o.a[n].id):(e=o.a[n].markerCategoryId+"-"+o.a[n].id+"-"+o.a[n].name.replace(/[^A-Z]/gi,"-"),i=o.a[n].markerCategoryId+"-"+o.a[n].id);var u='<div class="popupContainer" id = "popupDiv'+e+'">';if(null!=o.a[n].enName&&"1934"!=o.a[n].markerCategoryId&&"1916"!=o.a[n].markerCategoryId?(u+='<strong class="name">'+o.a[n].name+"("+o.a[n].enName+")</strong>",u+='<div class="buttonContainer">',u+='<span class="markButton" @click="MarkPoint(\''+e+'\')" data-key="'+e+'">标记</span>',u+='<a class="markButton" target="_blank" @click="markerInfo(\''+i+"','"+o.a[n].name+"')\"></a>",u+='<a class="markButton" target="_blank" href="http://www.ign.com/search?q='+encodeURIComponent(o.a[n].enName)+'"></a>',u+='<a class="markButton" target="_blank" href="https://c.gufen.ga/#q='+encodeURIComponent(o.a[n].enName)+'"></a>',u+='<a class="markButton" target="_blank" href="http://www.baidu.com/baidu?word='+encodeURIComponent(o.a[n].enName+" "+o.a[n].name)+'"></a>',u+='<a class="" target="_blank" @click="editRaiders(\''+i+"')\"></a>"):(u+='<strong class="name">'+o.a[n].name+"</strong>",u+='<div class="buttonContainer">',u+='<span class="markButton" @click="MarkPoint(\''+e+'\')" data-key="'+e+'">标记</span>',u+='<a class="markButton" target="_blank" @click="markerInfo(\''+i+"')\"></a>",u+='<a class="markButton" target="_blank" href="http://www.ign.com/search?q='+encodeURIComponent(o.a[n].name)+'"></a>',u+='<a class="markButton" target="_blank" href="https://c.gufen.ga/#q='+encodeURIComponent(o.a[n].name)+'"></a>',u+='<a class="markButton" target="_blank" href="http://www.baidu.com/baidu?word='+encodeURIComponent(o.a[n].name)+'"></a>',u+='<a class="" target="_blank" @click="editRaiders(\''+i+"')\"></a>"),u+="</div>","1925"===o.a[n].markerCategoryId)if(l.a[o.a[n].enName]){var m=l.a[o.a[n].enName];u+='<strong class="name">'+m+"</strong>",u+='<div class="buttonContainer">',u+='<a class="markButton" target="_blank" href="https://zelda-bow..jp/?s='+m+'"></a>',u+='<a class="markButton" target="_blank" href="http://wiki2..jp/zelda_bow/index.php?'+m+'"></a>',u+='<a class="markButton" target="_blank" href="https://c.gufen.ga/#q='+m+'"></a>',u+='<a class="markButton" target="_blank" href="http://www.baidu.com/baidu?word='+m+'"></a>',u+="</div>"}else console.log("no find shrine janpanese: "+o.a[n].enName);u+="</div>";var d="mark-"+e;1==localStorage.getItem(e)&&(d+=" marked"),d+=" markIcon",d+=" icon-"+t.markerStyle[o.a[n].markerCategoryId];var p=L.marker([o.a[n].y,o.a[n].x],{title:o.a[n].name,icon:L.divIcon({className:d,iconSize:[20,20],iconAnchor:[10,10],popupAnchor:[0,-10]}),attribute:e}).bindPopup(u);p.on("click",function(e){var t=this.options.attribute;p.isPopupOpen()&&new r.default({el:"#popupDiv"+t,store:c.a,data:function(){return{test:"1111",markObject:s.a.Object.extend("markObj")}},methods:{MarkPoint:function(e){var t,a=localStorage.getItem(e);if(null==a){if(a=0,null!=s.a.User.current()){var r=s.a.User.current().attributes.username;(t=new this.markObject).set("userName",r),t.set("key",e)}}else{var n=localStorage.getItem("id"+e);null!=s.a.User.current()&&(t=s.a.Object.createWithoutData("markObj",n))}var i=void 0;0==a?i=1:1==a&&(i=0),localStorage.setItem(e,1==i?1:0);var o=document.querySelector("#MapContainer .leaflet-marker-pane .mark-"+e);o.className.indexOf("marked")>-1?o.classList.remove("marked"):o.classList.add("marked"),null!=s.a.User.current()&&(t.set("value",i),t.save().then(function(t){localStorage.setItem("id"+e,t.id)},function(e){console.error(e)}))},markerInfo:function(e,t){this.$store.dispatch("getMarkInfo",e),this.$layer.iframe({content:{content:h,parent:this,data:[]},area:["85%","65%"],title:t})},editRaiders:function(e){a.push({name:"editRaider",params:{id:e}})}}})}),t.cacheMarker.push(p)}()}this.markerGroup=L.layerGroup(this.cacheMarker),this.map.addLayer(this.markerGroup)},clearSearch:function(){this.search=""},MarkPointMarkPoint:function(e){console.log(e)},refreshFilter:function(){for(var e in this.visibleMarker)visibleMarker.hasOwnProperty(e)&&(visibleMarker[e]?!1:!1)},openList:function(){"block"!=this.display?this.display="block":this.display="none"},login:function(){this.currentUser=s.a.User.current(),this.currentUser?this.logout():this.$router.push({path:"info"})},logout:function(){var e=this;this.$confirm("是否注销登录?注销后会清空所有的本地点位信息!","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){localStorage.clear(),s.a.User.logOut(),e.currentUser=s.a.User.current(),e.loginSign="",e.$message({type:"success",message:"注销成功!"})}).catch(function(){})},moreSelect:function(e){"one"==e&&(this.selectModle=!1),"more"==e&&(this.selectModle=!0)},getInfoJson:function(){var e=this,t=this;new s.a.Query("updateInfo").get("5aa2437d9545040065e2b8fa").then(function(a){t.textUpdate=a.attributes.updateInfo,e.updateInfo()})}},created:function(){},mounted:function(){this.initMap(),this.handleMarkData(),this.getUserName(),this.getInfoJson()},watch:{search:function(e){""==e||this.refreshMarker("search")}}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{height:"100%"},attrs:{id:"index"}},[a("div",{attrs:{id:"TypeSwitch"}},[a("strong",{on:{click:function(t){e.openList()}}},[e._v("类型筛选")]),e._v(" "),a("ul",{style:{overflow:"auto",height:"20rem",display:e.display}},[a("li",{staticClass:"search"},[a("el-input",{staticStyle:{padding:"5%"},attrs:{placeholder:"请输入关键词",size:"mini",clearable:""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),a("li",{class:{current:!e.selectModle},on:{click:function(t){e.moreSelect("one")}}},[e._v("单选")]),e._v(" "),a("li",{class:{current:e.selectModle},on:{click:function(t){e.moreSelect("more")}}},[e._v("多选")]),e._v(" "),e._l(e.markerCatalog,function(t){return[a("li",{staticClass:"title"},[e._v(e._s(t.name))]),e._v(" "),e._l(t.children,function(t){return a("li",{class:["icon-"+t.img,{current:e.typeSelect[t.id]}],attrs:{"data-type":t.id},on:{click:function(a){e.toggleVisible(t.id,a)}}},[e._v(e._s(t.name))])})]})],2)]),e._v(" "),a("div",{attrs:{id:"NameSearch"}},[a("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){e.login()}}},[e._v(e._s(e.loginSign))])],1),e._v(" "),a("div",{attrs:{id:"info"}},[a("a",{attrs:{href:"#"},on:{click:function(t){e.$router.push("sponsor")}}},[e._v("")]),a("a",{attrs:{href:"#"},on:{click:function(t){e.$router.push("appdownload")}}},[e._v("")])]),e._v(" "),a("div",{attrs:{id:"MapContainer"}})])},staticRenderFns:[]},f=a("Mw9A")(d,p,!1,function(e){a("jDtU")},null,null);t.default=f.exports},jDtU:function(e,t){},wMrN:function(e,t){}});
//# sourceMappingURL=2.7ad2ab0c60c9792d36e8.js.map
